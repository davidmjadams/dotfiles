select * from provider_location where provider_public_url = 'kg-doodles-ltd-RP533131';
select 'hello' from provider;
\q
select * from provider;
begin;with new_profile as (  insert into provider_profile(id, name, address, post_code, ofsted_urn)  values (uuid_generate_v4(), 'KG Doodles at St John the Divine CofE', 'KG Doodles at St John the Divine CofE, Warham Road, Camberwell London', 'SE5 0SX', '2646991')  returning id)insert into provider_location (uuid, public_url, provider_public_url, status, tax_free_childcare_payment_urn)select id, 'kg-doodles-st-john-2646991', 'soccer-club-RP8800221', 'verified', '2646991' from new_profile;select * from location where provider_public_url = 'soccer-club-RP8800221';rollback;
begin;with new_profile as (  insert into provider_profile(id, name, address, post_code, ofsted_urn)  values (uuid_generate_v4(), 'KG Doodles at St John the Divine CofE', 'KG Doodles at St John the Divine CofE, Warham Road, Camberwell London', 'SE5 0SX', '2646991')  returning profile_id)insert into provider_location (uuid, public_url, provider_public_url, status, tax_free_childcare_payment_urn)select profile_id, 'kg-doodles-st-john-2646991', 'soccer-club-RP8800221', 'verified', '2646991' from new_profile;select * from location where provider_public_url = 'soccer-club-RP8800221';rollback;
begin;with new_profile as (  insert into provider_profile(id, name, address, post_code, ofsted_urn)  values (uuid_generate_v4(), 'KG Doodles at St John the Divine CofE', 'KG Doodles at St John the Divine CofE, Warham Road, Camberwell London', 'SE5 0SX', '2646991')  returning id)insert into provider_location (uuid, public_url, provider_public_url, profile_id, status, tax_free_childcare_payment_urn)select uuid_generate_v4(), 'kg-doodles-st-john-2646991', 'soccer-club-RP8800221', id, 'verified', '2646991' from new_profile;select * from location where provider_public_url = 'soccer-club-RP8800221';rollback;
select * from provider;
gin;
with new_profile as (  insert into provider_profile(id, name, address, post_code, ofsted_urn)  values (uuid_generate_v4(), 'KG Doodles at St John the Divine CofE', 'KG Doodles at St John the Divine CofE, Warham Road, Camberwell London', 'SE5 0SX', '2646991')  returning id)insert into provider_location (uuid, public_url, provider_public_url, profile_id, status, tax_free_childcare_payment_urn)select uuid_generate_v4(), 'kg-doodles-st-john-2646991', 'soccer-club-RP8800221', id, 'verified', '2646991' from new_profile;
select * from location where provider_public_url = 'soccer-club-RP880022';
rollback;
begin;with new_profile as (  insert into provider_profile(id, name, address, post_code, ofsted_urn)  values (uuid_generate_v4(), 'KG Doodles at St John the Divine CofE', 'KG Doodles at St John the Divine CofE, Warham Road, Camberwell London', 'SE5 0SX', '2646991')  returning id)insert into provider_location (uuid, public_url, provider_public_url, profile_id, status, tax_free_childcare_payment_urn)select uuid_generate_v4(), 'kg-doodles-st-john-2646991', 'soccer-club-RP8800221', id, 'verified', '2646991' from new_profile;select * from location where provider_public_url = 'soccer-club-RP880022';rollback;
begin;with new_profile as (  insert into provider_profile(id, name, address, post_code, ofsted_urn)  values (uuid_generate_v4(), 'KG Doodles at St John the Divine CofE', 'KG Doodles at St John the Divine CofE, Warham Road, Camberwell London', 'SE5 0SX', '2646991')  returning id)insert into provider_location (uuid, public_url, provider_public_url, profile_id, status, tax_free_childcare_payment_urn)select uuid_generate_v4(), 'kg-doodles-st-john-2646991', 'soccer-club-RP880022', id, 'verified', '2646991' from new_profile;select * from location where provider_public_url = 'soccer-club-RP880022';rollback;
begin;with new_profile as (  insert into provider_profile(id, name, address, post_code, ofsted_urn)  values (uuid_generate_v4(), 'KG Doodles at St John the Divine CofE', 'KG Doodles at St John the Divine CofE, Warham Road, Camberwell London', 'SE5 0SX', '2646991')  returning id)insert into provider_location (uuid, public_url, provider_public_url, profile_id, status, tax_free_childcare_payment_urn)select uuid_generate_v4(), 'kg-doodles-st-john-2646991', 'soccer-club-RP880022', id, 'verified', '2646991' from new_profile;select * from provider_location where provider_public_url = 'soccer-club-RP880022';rollback;
begin;with new_profile as (  insert into provider_profile(id, name, address, post_code, ofsted_urn)  values (uuid_generate_v4(), 'KG Doodles at St John the Divine CofE', 'KG Doodles at St John the Divine CofE, Warham Road, Camberwell London', 'SE5 0SX', '2646991')  returning id)insert into provider_location (uuid, public_url, provider_public_url, profile_id, status, tax_free_childcare_payment_urn)select uuid_generate_v4(), 'kg-doodles-st-john-2646991', 'soccer-club-RP880022', id, 'verified', '2646991' from new_profile;select * from provider_location where provider_public_url = 'soccer-club-RP880022';commit;
begin;with new_profile as (  insert into provider_profile(id, name, address, post_code, ofsted_urn)  values (uuid_generate_v4(), 'KG Doodles at St John the Divine CofE', 'KG Doodles at St John the Divine CofE, Warham Road, Camberwell London', 'SE5 0SX', '2646991')  returning id)insert into provider_location (uuid, public_url, provider_public_url, profile_id, status, tax_free_childcare_payment_urn)select uuid_generate_v4(), 'kg-doodles-st-john-2646991', 'kg-doodles-ltd-RP533131', id, 'verified', '2646991' from new_profile;select * from provider_location where provider_public_url = 'kg-doodles-ltd-RP533131';rollback;
begin;with new_profile as (  insert into provider_profile(id, name, address, post_code, ofsted_urn)  values (uuid_generate_v4(), 'KG Doodles at St John the Divine CofE', 'KG Doodles at St John the Divine CofE, Warham Road, Camberwell London', 'SE5 0SX', '2646991')  returning id)insert into provider_location (uuid, public_url, provider_public_url, profile_id, status, tax_free_childcare_payment_urn)select uuid_generate_v4(), 'kg-doodles-st-john-2646991', 'kg-doodles-ltd-RP533131', id, 'verified', '2646991' from new_profile;select * from provider_location where provider_public_url = 'kg-doodles-ltd-RP533131';commit;
begin;with new_profile as (  insert into provider_profile(id, name, address, post_code, ofsted_urn)  values (uuid_generate_v4(), 'KG Doodles at West Thornton Primary School', 'West Thornton Primary School, Croydon',  'CR0 3BS', '2700068')  returning id)insert into provider_location (uuid, public_url, provider_public_url, profile_id, status, tax_free_childcare_payment_urn)select uuid_generate_v4(), 'kg-doodles-west-thornton-2700068', 'kg-doodles-ltd-RP533131', id, 'verified', '2700068' from new_profile;select * from provider_location where provider_public_url = 'kg-doodles-ltd-RP533131';rollback;
begin;with new_profile as (  insert into provider_profile(id, name, address, post_code, ofsted_urn)  values (uuid_generate_v4(), 'KG Doodles at West Thornton Primary School', 'West Thornton Primary School, Croydon',  'CR0 3BS', '2700068')  returning id)insert into provider_location (uuid, public_url, provider_public_url, profile_id, status, tax_free_childcare_payment_urn)select uuid_generate_v4(), 'kg-doodles-west-thornton-2700068', 'kg-doodles-ltd-RP533131', id, 'verified', '2700068' from new_profile;select * from provider_location where provider_public_url = 'kg-doodles-ltd-RP533131';commit;
alter table "provider" add column "payment_guarantee_disabled" boolean not null default false;
alter table "provider" drop column "payment_guarantee_disabled";
\q
create table "guarantee" ("id" text not null, "type" text check ("type" in (\'card\', \'none\', \'skipped\')) not null, "created_date" timestamptz(0) not null, "reason" text check ("reason" in (\'provider_settings\', \'card_payment\')) null, constraint "guarantee_pkey" primary key ("id"));
select * from provider;
create table "guarantee" ("id" text not null, "type" text check ("type" in (\'card\', \'none\', \'skipped\')) not null, "created_date" timestamptz(0) not null, "reason" text check ("reason" in (\'provider_settings\', \'card_payment\')) null, constraint "guarantee_pkey" primary key ("id"));
create table "guarantee" ("id" text not null, "type" text check ("type" in ('card', 'none', 'skipped')) not null, "created_date" timestamptz(0) not null, "reason" text check ("reason" in ('provider_settings', 'card_payment')) null, constraint "guarantee_pkey" primary key ("id"));
create index "guarantee_type_index" on "guarantee" ("type");
alter table "provider" add column "payment_guarantee_disabled" boolean not null default false;
alter table "intent" add column "guarantee_id" text not null;
\q
\q
alter table "intent" add column "guarantee_id" text null;
alter table "intent" add constraint "intent_guarantee_id_foreign" foreign key ("guarantee_id") references "guarantee" ("id") on update cascade;
alter table "intent" add constraint "intent_guarantee_id_unique" unique ("guarantee_id");
insert into guarantee set (id, type, created_date, reason) values (uuid_generate_v4(), 'skipped', now(), 'migration');
insert into guarantee (id, type, created_date, reason) values (uuid_generate_v4(), 'skipped', now(), 'migration');
describe guarantee;
\d guarantee;
drop table if exists "guarantee" cascade;
\d guarantee;
alter table "intent" drop constraint "intent_guarantee_id_foreign";
alter table "intent" drop constraint "intent_guarantee_id_unique";
alter table "intent" drop column "guarantee_id";
alter table "provider" drop column "payment_guarantee_disabled";
\d guarantee;
\d intent;
\d guarantee;
create table "guarantee" ("id" text not null, "type" text check ("type" in ('card', 'none', 'skipped')) not null, "created_date" timestamptz(0) not null, "reason" text check ("reason" in ('provider_settings', 'card_payment', 'migration')) null, constraint "guarantee_pkey" primary key ("id"));
\d guarantee;
create index "guarantee_type_index" on "guarantee" ("type");
alter table "provider" add column "payment_guarantee_disabled" boolean not null default false;
alter table "intent" add column "guarantee_id" text null;
alter table "intent" add constraint "intent_guarantee_id_foreign" foreign key ("guarantee_id") references "guarantee" ("id") on update cascade;
alter table "intent" add constraint "intent_guarantee_id_unique" unique ("guarantee_id");
insert into guarantee (id, type, created_date, reason) values (uuid_generate_v4(), 'skipped', now(), 'migration');
update intent set guarantee_id = '9b138865-bb3c-4601-a60e-9362f7c63a88';
alter table "intent" drop constraint "intent_guarantee_id_unique";
update intent set guarantee_id = '9b138865-bb3c-4601-a60e-9362f7c63a88';
alter table "intent" alter column "guarantee_id" set not null;
alter table "intent" drop constraint "intent_guarantee_id_foreign";
drop table if exists "guarantee" cascade;
alter table "intent" drop constraint "intent_guarantee_id_unique";
alter table "intent" drop column "guarantee_id";
alter table "provider" drop column "payment_guarantee_disabled";
\q
select * from guarantee;
\d intent;
create table "guarantee" ("id" text not null, "type" text check ("type" in (\'card\', \'none\', \'skipped\')) not null, "created_date" timestamptz(0) not null, "reason" text check ("reason" in (\'provider_settings\', \'card_payment\', \'migration\')) null, constraint "guarantee_pkey" primary key ("id"));
create table "guarantee" ("id" text not null, "type" text check ("type" in ('card', 'none', 'skipped')) not null, "created_date" timestamptz(0) not null, "reason" text check ("reason" in ('provider_settings', 'card_payment', 'migration')) null, constraint "guarantee_pkey" primary key ("id"));
create index "guarantee_type_index" on "guarantee" ("type");
alter table "provider" add column "payment_guarantee_disabled" boolean not null default false;
alter table "provider" add column "payment_guarantee_disabled" boolean not null default false;
alter table "provider" add column "payment_guarantee_disabled" boolean not null default false;
alter table "intent" add column "guarantee_id" text null;
WITH new_guarantee AS ( INSERT INTO guarantee (id, type, createdDate, reason)  values (uuid_v4_generate(), 'skipped', now(), 'migration')  RETURNING id)UPDATE intentSET gurantee_id = new_relation_uuids.uuidFROM new_guarantee;
WITH new_guarantee AS ( INSERT INTO guarantee (id, type, created_date, reason)  values (uuid_v4_generate(), 'skipped', now(), 'migration')  RETURNING id)UPDATE intentSET gurantee_id = new_relation_uuids.uuidFROM new_guarantee;
WITH new_guarantee AS ( INSERT INTO guarantee (id, type, created_date, reason)  values (uuid_generate_v4(), 'skipped', now(), 'migration')  RETURNING id)UPDATE intentSET gurantee_id = new_relation_uuids.uuidFROM new_guarantee;
WITH new_guarantee AS ( INSERT INTO guarantee (id, type, created_date, reason)  values (uuid_generate_v4(), 'skipped', now(), 'migration')  RETURNING id)UPDATE intentSET gurantee_id = new_guarantee.idFROM new_guarantee;
WITH new_guarantee AS ( INSERT INTO guarantee (id, type, created_date, reason)  values (uuid_generate_v4(), 'skipped', now(), 'migration')  RETURNING id)UPDATE intentSET guarantee_id = new_guarantee.idFROM new_guarantee;
drop table if exists "guarantee" cascade;
alter table "intent" drop column "guarantee_id";
create table "guarantee" ("id" text not null, "type" text check ("type" in ('card', 'none', 'skipped')) not null, "created_date" timestamptz(0) not null, "reason" text check ("reason" in ('provider_settings', 'card_payment', 'migration')) null, constraint "guarantee_pkey" primary key ("id"));
create index "guarantee_type_index" on "guarantee" ("type");
alter table "intent" add column "guarantee_id" text null;
alter table "intent" add constraint "intent_guarantee_id_foreign" foreign key ("guarantee_id") references "guarantee" ("id") on update cascade;
alter table "intent" add constraint "intent_guarantee_id_unique" unique ("guarantee_id");
WITH new_guarantee AS ( INSERT INTO guarantee (id, type, created_date, reason)  values (uuid_generate_v4(), 'skipped', now(), 'migration')  RETURNING id)UPDATE intentSET guarantee_id = new_guarantee.idFROM new_guarantee;
alter table "intent" drop constraint "intent_guarantee_id_foreign";
drop table if exists "guarantee" cascade;
alter table "intent" drop constraint "intent_guarantee_id_unique";
WITH updated_intent AS (UPDATE intent  SET guarantee_id = uuid_generate_v4()  RETURNING guarantee_id)INSERT INTO guarantee (id, type, created_date, reason)  values(updated_intent.guarantee_id, 'skipped', now(), 'migration')FROM updated_intent;
select * from intent limit 10;
select guarantee_id from intent limit 10;
select guarantee_id from intent limit 10;
WITH updated_intent AS (UPDATE intent  SET guarantee_id = uuid_generate_v4()  RETURNING intent.guarantee_id)INSERT INTO guarantee (id, type, created_date, reason)  values(updated_intent.guarantee_id, 'skipped', now(), 'migration')FROM updated_intent;
WITH updated_intent AS (UPDATE intent  SET guarantee_id = uuid_generate_v4()  RETURNING intent.guarantee_idselect * from updated_intent);
WITH updated_intent AS (UPDATE intent  SET guarantee_id = uuid_generate_v4()  RETURNING intent.guarantee_id);select * from updated_intent;
WITH updated_intent AS (UPDATE intent  SET guarantee_id = uuid_generate_v4()  RETURNING intent.guarantee_id)select * from updated_intent;
WITH updated_intent AS (UPDATE intent  SET guarantee_id = uuid_generate_v4()  RETURNING intent.guarantee_id)select * from updated_intentINSERT INTO guarantee (id, type, created_date, reason)  values(updated_intent.guarantee_id, 'skipped', now(), 'migration')FROM updated_intent;
WITH updated_intent AS (UPDATE intent  SET guarantee_id = uuid_generate_v4()  RETURNING intent.guarantee_id)INSERT INTO guarantee (id, type, created_date, reason)  values(updated_intent.guarantee_id, 'skipped', now(), 'migration');
create table "guarantee" ("id" text not null, "type" text check ("type" in ('card', 'none', 'skipped')) not null, "created_date" timestamptz(0) not null, "reason" text check ("reason" in ('provider_settings', 'card_payment', 'migration')) null, constraint "guarantee_pkey" primary key ("id"));    create index "guarantee_type_index" on "guarantee" ("type");
WITH updated_intent AS (UPDATE intent  SET guarantee_id = uuid_generate_v4()  RETURNING intent.guarantee_id)INSERT INTO guarantee (id, type, created_date, reason)  values(updated_intent.guarantee_id, 'skipped', now(), 'migration');
WITH updated_intent AS (UPDATE intent  SET guarantee_id = uuid_generate_v4()  RETURNING intent.guarantee_id)INSERT INTO guarantee (id, type, created_date, reason)  values(updated_intent.guarantee_id, 'skipped', now(), 'migration')FROM updated_intent;
WITH updated_intent AS (UPDATE intent  SET guarantee_id = uuid_generate_v4()  RETURNING intent.guarantee_id)INSERT INTO guarantee (id, type, created_date, reason)  values(updated_intent.guarantee_id, 'skipped', now(), 'migration');
WITH updated_intent AS (UPDATE intent  SET guarantee_id = uuid_generate_v4()  RETURNING guarantee_id)INSERT INTO guarantee (id, type, created_date, reason)  values(updated_intent.guarantee_id, 'skipped', now(), 'migration')FROM updated_intent;
WITH updated_intent AS (UPDATE intent  SET guarantee_id = uuid_generate_v4()  RETURNING guarantee_id)FROM updated_intent INSERT INTO guarantee (id, type, created_date, reason)  values(updated_intent.guarantee_id, 'skipped', now(), 'migration');
WITH updated_intent AS (UPDATE intent  SET guarantee_id = uuid_generate_v4()  RETURNING guarantee_id)select * from updated_intent;
alter table "intent" drop column "guarantee_id";
alter table "intent" add column "guarantee_id" text null;
WITH updated_intent AS (UPDATE intent  SET guarantee_id = uuid_generate_v4()  RETURNING guarantee_id)INSERT INTO guarantee (id, type, created_date, reason)  values(select guarantee_i from updated_intent, 'skipped', now(), 'migration');
WITH updated_intent AS (UPDATE intent  SET guarantee_id = uuid_generate_v4()  RETURNING guarantee_id)INSERT INTO guarantee (id, type, created_date, reason)  values((select guarantee_i from updated_intent), 'skipped', now(), 'migration');
WITH updated_intent AS (UPDATE intent  SET guarantee_id = uuid_generate_v4()  RETURNING guarantee_id)INSERT INTO guarantee (id, type, created_date, reason)  values((select guarantee_id from updated_intent), 'skipped', now(), 'migration');
WITH updated_intent AS (UPDATE intent  SET guarantee_id = uuid_generate_v4()  RETURNING guarantee_id)select guarantee_id from updated_intent;
alter table "intent" drop column "guarantee_id";
alter table "intent" add column "guarantee_id" text null;
INSERT INTO guarantee (id, type, created_date, reason) VALUES((UPDATE intent  SET guarantee_id = uuid_generate_v4()  RETURNING guarantee_id), 'skipped', now(), 'migration');
INSERT INTO guarantee (id, type, created_date, reason) VALUES(With updated_intent as (UPDATE intent  SET guarantee_id = uuid_generate_v4()  RETURNING guarantee_id), 'skipped', now(), 'migration');
INSERT INTO guarantee (id, type, created_date, reason) VALUES((select guarantee_id from (UPDATE intent  SET guarantee_id = uuid_generate_v4()  RETURNING guarantee_id)), 'skipped', now(), 'migration');
UPDATE intent  SET guarantee_id = uuid_generate_v4()  RETURNING guarantee_id;
alter table "intent" drop column "guarantee_id";
alter table "intent" add column "guarantee_id" text null;
(select guarantee_id from UPDATE intent  SET guarantee_id = uuid_generate_v4()  RETURNING guarantee_id);
select guarantee_id from (UPDATE intent  SET guarantee_id = uuid_generate_v4()  RETURNING guarantee_id);
select guarantee_id from (select guarantee_id from UPDATE intent  SET guarantee_id = uuid_generate_v4()  RETURNING guarantee_id);
WITH new_guarantee AS ( INSERT INTO guarantee (id, created_date, type, reason) values (uuid_generate_v4(), now(), 'skipped', 'migration') RETURNING uuid)UPDATE intentSET intent.guarantee_id = new_guarantee.idFROM new_guarantee;
WITH new_guarantee AS ( INSERT INTO guarantee (id, created_date, type, reason) values (uuid_generate_v4(), now(), 'skipped', 'migration') RETURNING uuid)UPDATE intentSET intent.guarantee_nteeWITH new_guarantee AS ( INSERT INTO guarantee (id, created_date, type, reason) values (uuid_generate_v4(), now(), 'skipped', 'migration') RETURNING id)UPDATE intentSET intent.guarantee_id = new_guarantee.idFROM new_guarantee;
;
WITH new_guarantee AS ( INSERT INTO guarantee (id, created_date, type, reason) values (uuid_generate_v4(), now(), 'skipped', 'migration') RETURNING id)UPDATE intentSET intent.guarantee_id = new_guarantee.idFROM new_guarantee;
WITH new_guarantee AS ( INSERT INTO guarantee (id, created_date, type, reason) values (uuid_generate_v4(), now(), 'skipped', 'migration') RETURNING id)UPDATE intentSET guarantee_id = new_guarantee.idFROM new_guarantee;
update intent set guarantee_id = uuid_v4_generate();
update intent set guarantee_id = uuid_generate_v4();
insert into gurarantee (id, created_date, type, reason) values ((select guarantee_id from intent), now(), 'skipped', 'migration');
insert into guarantee (id, created_date, type, reason) values ((select guarantee_id from intent), now(), 'skipped', 'migration');
insert into guarantee (id, created_date, type, reason) select guarantee_id, now(), 'skipped', 'migration' from intent;
alter table "intent" add constraint "intent_guarantee_id_foreign" foreign key ("guarantee_id") references "guarantee" ("id") on update cascade;
alter table "intent" add constraint "intent_guarantee_id_unique" unique ("guarantee_id");
this.addSql('alter table "intent" drop constraint "intent_guarantee_id_foreign";');
alter table "intent" drop constraint "intent_guarantee_id_foreign";
drop table if exists "guarantee" cascade;
alter table "intent" drop constraint "intent_guarantee_id_unique";
alter table "intent" drop column "guarantee_id";
alter table "provider" drop column "payment_guarantee_disabled";
\q
seelct * from guarantee where reason = 'migration';
select * from guarantee where reason = 'migration';
select * from now() - 14;
select * from now() - interval 14 'day';
select * from now() - interval '14' 'day';
select * from now();
select * from (now() - interval '14 day');
select * from (current_date - interval '14 day');
select * from current_date - interval '10 days' ;
current_date - interval '10 days' ;
now();
select created_date from intent;
select created_date from guarantee;
select created_date - interval '20' day from guarantee;
\q
select created_date - interval '20' day from guarantee;
begin;
update guarantee set creadted_date = created_date - interval '20' day;
update guarantee set created_date = created_date - interval '20' day;
rollback;
begin;
update guarantee set created_date = created_date - interval '20' day;
select * from guarantee;
commit;
update guarantee set created_date = created_date - interval '20' day;
\q
begin; update guarantee set created_date = created_date - interval '20' day;
select * from guarantee;
commit;
\q
select * from intent left join subsidy on subdiy.uuid = intent.subsidy_uuid where payment_captured_date is not null AND completed_date is null;
select * from intent left join subsidy on subsidy.uuid = intent.subsidy_uuid where payment_captured_date is not null AND completed_date is null;
select * from intent left join subsidy on subsidy.uuid = intent.subsidy_uuid where payment_captured_date is not null AND completed_date is null and scheme in ('childcare-voucher', 'tax-free-childcare');
select * from intent left join subsidy on subsidy.uuid = intent.subsidy_uuid where payment_captured_date is not null AND completed_date is null and scheme = 'card';
select * from intent where payment_captured_date is not null AND completed_date is null;
select guarantee_id from intent where payment_captured_date is not null AND completed_date is null;
update guarantee set type='card' where id in ('90e6a0d0-bdcf-4561-9656-0aeb9619d743','b50133c2-a83c-4107-890a-ef412c93e8af','ea00086b-15bc-4693-99a4-66e6b2931d61','a1955600-b60b-46da-ab86-dcbd9a9a34fa','2191f62f-539e-4d4e-80d1-20e9fbc846d5','78ad78bd-38e2-4e94-a404-1c0c47b0f930','43cd97d2-d149-4be2-886c-e3f2c5edb432','78534f80-ee2e-4e2d-9f08-8f2cc1d31ff1','6387f33a-64cc-48d2-ab29-d8eba638d12b','19f0602a-b621-40c1-8708-5a4d13b5e4e0','b5c52db6-b1bb-4c4c-bebe-e25f4dc1a171','58ec6521-7b93-4751-8fa0-b97c36421918','7f56b98c-b7a9-430e-a9d7-409fcc348b33','c7807edd-47a1-4756-b460-ed1bf5e13056');
\q
select * from intent;
begin;with new_profile as (  insert into provider_profile(id, name, address, post_code, ofsted_urn)  values (uuid_generate_v4(), 'Richer Education, University of Westminster', 'Richer Education, University of Westminster, 35 Marylebone Road. Marylebone', 'NW1 5LS', '-')  returning id)insert into provider_location (uuid, public_url, provider_public_url, profile_id, status, tax_free_childcare_payment_urn)select uuid_generate_v4(), 'richer-education-university-westminster', 'richer-education', id, 'verified', '-' from new_profile;select * from provider_location where provider_public_url = 'richer-education';rollback;
begin;with new_profile as (  insert into provider_profile(id, name, address, post_code, ofsted_urn)  values (uuid_generate_v4(), 'Richer Education, University of Westminster', 'Richer Education, University of Westminster, 35 Marylebone Road. Marylebone', 'NW1 5LS', '-')  returning id)insert into provider_location (uuid, public_url, provider_public_url, profile_id, status, tax_free_childcare_payment_urn)select uuid_generate_v4(), 'richer-education-university-westminster', 'richer-education', id, 'verified', '-' from new_profile;select * from provider_location where provider_public_url = 'richer-education';;
commit;
\q
begin;
insert into public.user (uuid, role, email) values (uuid_generate_v4(), 'admin', 'jpsch023@gmail.com');
select * from user where email = 'jpsch023@gmail.com';
select * from public.user where email = 'jpsch023@gmail.com';
insert into public.user (uuid, role, email) values (uuid_generate_v4(), 'admin', 'jpsch023@gmail.com');
rollback;
insert into public.user (uuid, role, email) values (uuid_generate_v4(), 'admin', 'jpsch023@gmail.com');
select * from public.user where email = 'jpsch023@gmail.com';
\q
 update provider set public_url = 'cc' where public_url = 'creative-kids-RP125646';
 update provider set public_url = 'creative-kids-RP125646' where public_url = 'cc';
\q
begin;
update provider set public_url = 'premier-education-2515846' where public_url = 'simpson-gareth-lee-2515846';
rollback;
begin;
update provider_location set provider_public_url = 'premier-education-2515846' where provider_public_url = 'simpson-gareth-lee-2515846';
\q
BEGIN;-- Step 3: Drop the foreign key constraint from the provider_location tableALTER TABLE provider_locationDROP CONSTRAINT provider_location_provider_public_url_foreign;-- Step 4: Update the primary key value in the provider tableUPDATE providerSET public_url = 'cc'WHERE public_url = 'creative-kids-RP125646';-- Step 5: Update the foreign key value in the provider_location tableUPDATE provider_locationSET provider_public_url = 'cc'WHERE provider_public_url = 'creative-kids-RP125646';-- Step 6: Re-add the foreign key constraint to the provider_location tableALTER TABLE provider_locationADD CONSTRAINT provider_location_provider_public_url_foreignFOREIGN KEY (provider_public_url)REFERENCES provider(public_url);
commit;
update provider set public_url = 'creative-kids-RP125646' where public_url = 'cc';
BEGIN;-- Step 3: Drop the foreign key constraint from the provider_location tableALTER TABLE provider_locationDROP CONSTRAINT provider_location_provider_public_url_foreign;-- Step 4: Update the primary key value in the provider tableUPDATE providerSET public_url = 'creative-kids-RP125646'WHERE public_url = 'cc';-- Step 5: Update the foreign key value in the provider_location tableUPDATE provider_locationSET provider_public_url = 'creative-kids-RP125646'WHERE provider_public_url = 'cc';-- Step 6: Re-add the foreign key constraint to the provider_location tableALTER TABLE provider_locationADD CONSTRAINT provider_location_provider_public_url_foreignFOREIGN KEY (provider_public_url)REFERENCES provider(public_url);
commit;
\q
BEGIN;-- Step 3: Drop the foreign key constraint from the provider_location tableALTER TABLE provider_locationDROP CONSTRAINT provider_location_provider_public_url_foreign;-- Step 4: Update the primary key value in the provider tableUPDATE providerSET public_url = 'premier-education-2515846'WHERE public_url = 'simpson-gareth-lee-2515846';-- Step 5: Update the foreign key value in the provider_location tableUPDATE provider_locationSET provider_public_url = 'premier-education-2515846'WHERE provider_public_url = 'simpson-gareth-lee-2515846';-- Step 6: Re-add the foreign key constraint to the provider_location tableALTER TABLE provider_locationADD CONSTRAINT provider_location_provider_public_url_foreignFOREIGN KEY (provider_public_url)REFERENCES provider(public_url);
commit;
select * from provider where public_url = 'premier-education-2515846';
\q
insert into "public"."provider" ("childcare_vouchers_enabled", "credit_debit_card_enabled", "different_payment_urns", "different_voucher_accounts", "payment_guarantee_disabled", "profile_id", "public_url", "status", "stripe_account", "tax_free_childcare_enabled", "uuid") values (true, false, false, true, false, 'cd4a613f-90dd-4ebd-9489-caee60ee980a', 'premier-education-2515846', 'verified', NULL, true, 'cb10eb94-5e6e-4003-bc0f-0ba7f54f9291');
begin;
insert into "public"."provider_profile" ("address", "description", "email", "id", "image_url", "logo_url", "name", "ofsted_urn", "phone_number", "post_code", "search", "updated_at", "website") values ('', 'Formed in 1999, Premier Education is dedicated to improving the health and wellbeing of children through active learning. We deliver sports, arts, and wellbeing courses to around 240,000 primary school children every year.Having started more than 20 years ago offering just football camps, we have evolved into the No.1 provider of sports and physical activities to primary school children in the UK. This status is something we take great pride in. Our network of coaches has grown to over 1000 and it is their passion for what they do that sets us apart. Inspiring a life-long love of sport and being active is at the heart of all of us.', 'info@premier-education.com', 'cd4a613f-90dd-4ebd-9489-caee60ee980a', 'https://res.cloudinary.com/ponchocare/image/upload/c_fill,g_auto,h_600,w_1080/v1680084032/ponchopay/providers/simpson-gareth-lee-2515846/banner', 'https://res.cloudinary.com/ponchocare/image/upload/h_75/v1680083936/ponchopay/providers/simpson-gareth-lee-2515846/logo', 'Premier Education', '2515846', '01953 499040', '', '''000'':31C ''1000'':84C ''1999'':5C ''20'':41C ''240'':30C ''activ'':19C,59C,108C ''ago'':43C ''apart'':97C ''around'':29C ''art'':24C ''camp'':47C ''children'':17C,34C,63C ''coach'':79C ''cours'':27C ''dedic'':9C ''deliv'':22C ''educ'':2A,7C ''everi'':35C ''evolv'':50C ''footbal'':46C ''form'':3C ''great'':73C ''grown'':81C ''health'':13C ''heart'':112C ''improv'':11C ''inspir'':98C ''learn'':20C ''life'':101C ''life-long'':100C ''long'':102C ''love'':103C ''network'':77C ''no.1'':53C ''offer'':44C ''passion'':89C ''physic'':58C ''premier'':1A,6C ''pride'':74C ''primari'':32C,61C ''provid'':54C ''school'':33C,62C ''set'':95C ''someth'':70C ''sport'':23C,56C,105C ''start'':38C ''status'':68C ''take'':72C ''uk'':66C ''us'':96C,116C ''wellb'':15C,26C ''year'':36C,42C', '2023-03-30 08:23:56+00', 'https://www.premier-education.com/');
rollback;
begin;
insert into "public"."provider_profile" ("address", "description", "email", "id", "image_url", "logo_url", "name", "ofsted_urn", "phone_number", "post_code", "updated_at", "website") values ('', 'Formed in 1999, Premier Education is dedicated to improving the health and wellbeing of children through active learning. We deliver sports, arts, and wellbeing courses to around 240,000 primary school children every year.Having started more than 20 years ago offering just football camps, we have evolved into the No.1 provider of sports and physical activities to primary school children in the UK. This status is something we take great pride in. Our network of coaches has grown to over 1000 and it is their passion for what they do that sets us apart. Inspiring a life-long love of sport and being active is at the heart of all of us.', 'info@premier-education.com', 'cd4a613f-90dd-4ebd-9489-caee60ee980a', 'https://res.cloudinary.com/ponchocare/image/upload/c_fill,g_auto,h_600,w_1080/v1680084032/ponchopay/providers/simpson-gareth-lee-2515846/banner', 'https://res.cloudinary.com/ponchocare/image/upload/h_75/v1680083936/ponchopay/providers/simpson-gareth-lee-2515846/logo', 'Premier Education', '2515846', '01953 499040', NULL, '2023-03-30 08:23:56+00', 'https://www.premier-education.com/');
select * from provider_profile where id = 'cd4a613f-90dd-4ebd-9489-caee60ee980a';
rollback;
select * from provider_profile where id = 'cd4a613f-90dd-4ebd-9489-caee60ee980a';
insert into "public"."provider" ("childcare_vouchers_enabled", "credit_debit_card_enabled", "different_payment_urns", "different_voucher_accounts", "payment_guarantee_disabled", "profile_id", "public_url", "status", "stripe_account", "tax_free_childcare_enabled", "uuid") values (true, false, false, true, false, 'cd4a613f-90dd-4ebd-9489-caee60ee980a', 'premier-education-2515846', 'verified', NULL, true, 'cb10eb94-5e6e-4003-bc0f-0ba7f54f9291');
rollback;
\q
begin;
insert into "public"."provider_profile" ("address", "description", "email", "id", "image_url", "logo_url", "name", "ofsted_urn", "phone_number", "post_code", "updated_at", "website") values ('', 'Formed in 1999, Premier Education is dedicated to improving the health and wellbeing of children through active learning. We deliver sports, arts, and wellbeing courses to around 240,000 primary school children every year.Having started more than 20 years ago offering just football camps, we have evolved into the No.1 provider of sports and physical activities to primary school children in the UK. This status is something we take great pride in. Our network of coaches has grown to over 1000 and it is their passion for what they do that sets us apart. Inspiring a life-long love of sport and being active is at the heart of all of us.', 'info@premier-education.com', 'cd4a613f-90dd-4ebd-9489-caee60ee980a', 'https://res.cloudinary.com/ponchocare/image/upload/c_fill,g_auto,h_600,w_1080/v1680084032/ponchopay/providers/simpson-gareth-lee-2515846/banner', 'https://res.cloudinary.com/ponchocare/image/upload/h_75/v1680083936/ponchopay/providers/simpson-gareth-lee-2515846/logo', 'Premier Education', '2515846', '01953 499040', NULL, '2023-03-30 08:23:56+00', 'https://www.premier-education.com/');
insert into "public"."provider" ("childcare_vouchers_enabled", "credit_debit_card_enabled", "different_payment_urns", "different_voucher_accounts", "payment_guarantee_disabled", "profile_id", "public_url", "status", "stripe_account", "tax_free_childcare_enabled", "uuid") values (true, false, false, true, false, 'cd4a613f-90dd-4ebd-9489-caee60ee980a', 'premier-education-2515846', 'verified', NULL, true, 'cb10eb94-5e6e-4003-bc0f-0ba7f54f9291');
commit;
insert into "public"."provider_location" ("profile_id", "provider_public_url", "public_url", "status", "tax_free_childcare_payment_urn", "uuid") values ('90020cca-5e9b-488c-b124-dac70f81a1fc', 'premier-education-2515846', 'premier-wrap-around-care-2548689', 'verified', '2548689', 'f0566756-051d-4ee8-8093-d8468842a079');
insert into "public"."provider_location" ("profile_id", "provider_public_url", "public_url", "status", "tax_free_childcare_payment_urn", "uuid") values ('90020cca-5e9b-488c-b124-dac70f81a1fc', 'premier-education-2515846', 'premier-wrap-around-care-2548689', 'verified', '2548689', 'f0566756-051d-4ee8-8093-d8468842a079');
insert into "public"."provider_profile" ("address", "description", "email", "id", "image_url", "logo_url", "name", "ofsted_urn", "phone_number", "post_code", "updated_at", "website") values ('University Of Cambridge Primary School, Eddington Avenue, Cambridge, Cambridgeshire, CB3 0QZ', NULL, NULL, '90020cca-5e9b-488c-b124-dac70f81a1fc', NULL, NULL, 'Premier Wrap Around Care', '2548689', '01223792440', 'CB3 0QZ', '2022-11-09 04:44:05+00', NULL);
insert into "public"."provider_location" ("profile_id", "provider_public_url", "public_url", "status", "tax_free_childcare_payment_urn", "uuid") values ('90020cca-5e9b-488c-b124-dac70f81a1fc', 'premier-education-2515846', 'premier-wrap-around-care-2548689', 'verified', '2548689', 'f0566756-051d-4ee8-8093-d8468842a079');
\q
select * from uuid_generate_v4();
select * from public.user limit 10;
insert into user (uuid, role, email, provider_public_url) values (uuid_generate_v4(), 'provider', 'hello@redbridgetuition.co.uk', 'redbridge-tuition-RP512763');
insert into public.user (uuid, role, email, provider_public_url) values (uuid_generate_v4(), 'provider', 'hello@redbridgetuition.co.uk', 'redbridge-tuition-RP512763');
insert into public.user (uuid, role, email, provider_public_url) values (uuid_generate_v4(), 'provider', 'halifax@stagecoach.co.uk', 'stagecoach-performing-arts-halifax-RP562866');
\q
